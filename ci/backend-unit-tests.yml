test_security:
  stage: test
  interruptible: true
  tags:
    - hetzner-gitLab-runner-1
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-UT.*/'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-TESTS.*/'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: '$CI_COMMIT_TAG =~ /^sg-flx-.*/'
      when: always
    - when: always
  script:
    - UUID=$(uuidgen)
    - echo $UUID
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION clean install -DskipTests
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION -pl security test
  artifacts:
    when: always
    reports:
      junit:
        - "*/target/surefire-reports/TEST-*.xml"
        - "*/target/failsafe-reports/TEST-*.xml"
    expire_in: 1 week
  cache:
    key: mavenrepo
    paths:
      - .m2/repository
    policy: pull

test_security_legacy:
  stage: test
  interruptible: true
  tags:
    - hetzner-gitLab-runner-1
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-UT.*/'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-TESTS.*/'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: '$CI_COMMIT_TAG =~ /^sg-flx-.*/'
      when: always
    - when: always
  script:
    - UUID=$(uuidgen)
    - echo $UUID
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION clean install -DskipTests
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION -pl security-legacy test
  artifacts:
    when: always
    reports:
      junit:
        - "*/target/surefire-reports/TEST-*.xml"
        - "*/target/failsafe-reports/TEST-*.xml"
    expire_in: 1 week
  cache:
    key: mavenrepo
    paths:
      - .m2/repository
    policy: pull

test_ssl:
  stage: test
  interruptible: true
  tags:
    - hetzner-gitLab-runner-1
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-UT.*/'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-TESTS.*/'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: '$CI_COMMIT_TAG =~ /^sg-flx-.*/'
      when: always
    - when: always
  script:
    - UUID=$(uuidgen)
    - echo $UUID
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION clean install -DskipTests
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION -pl ssl test
  artifacts:
    when: always
    reports:
      junit:
        - "*/target/surefire-reports/TEST-*.xml"
        - "*/target/failsafe-reports/TEST-*.xml"
    expire_in: 1 week
  cache:
    key: mavenrepo
    paths:
      - .m2/repository
    policy: pull

test_signals:
  stage: test
  interruptible: true
  tags:
    - hetzner-gitLab-runner-1
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-UT.*/'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-TESTS.*/'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: '$CI_COMMIT_TAG =~ /^sg-flx-.*/'
      when: always
    - when: always
  script:
    - UUID=$(uuidgen)
    - echo $UUID
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION clean install -DskipTests
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION -pl signals test
  artifacts:
    when: always
    reports:
      junit:
        - "*/target/surefire-reports/TEST-*.xml"
        - "*/target/failsafe-reports/TEST-*.xml"
    expire_in: 1 week
  cache:
    key: mavenrepo
    paths:
      - .m2/repository
    policy: pull

test_scheduler:
  stage: test
  interruptible: true
  tags:
    - hetzner-gitLab-runner-1
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-UT.*/'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-TESTS.*/'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: '$CI_COMMIT_TAG =~ /^sg-flx-.*/'
      when: always
    - when: always
  script:
    - UUID=$(uuidgen)
    - echo $UUID
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION clean install -DskipTests
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION -pl scheduler test
  artifacts:
    when: always
    reports:
      junit:
        - "*/target/surefire-reports/TEST-*.xml"
        - "*/target/failsafe-reports/TEST-*.xml"
    expire_in: 1 week
  cache:
    key: mavenrepo
    paths:
      - .m2/repository
    policy: pull

test_support:
  stage: test
  interruptible: true
  tags:
    - hetzner-gitLab-runner-1
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-UT.*/'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-TESTS.*/'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: '$CI_COMMIT_TAG =~ /^sg-flx-.*/'
      when: always
    - when: always
  script:
    - UUID=$(uuidgen)
    - echo $UUID
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION clean install -DskipTests
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION -pl support test
  artifacts:
    when: always
    reports:
      junit:
        - "*/target/surefire-reports/TEST-*.xml"
        - "*/target/failsafe-reports/TEST-*.xml"
    expire_in: 1 week
  cache:
    key: mavenrepo
    paths:
      - .m2/repository
    policy: pull

test_dlic_security:
  stage: test
  interruptible: true
  tags:
    - hetzner-gitLab-runner-1
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-UT.*/'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-TESTS.*/'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: '$CI_COMMIT_TAG =~ /^sg-flx-.*/'
      when: always
    - when: always
  script:
    - UUID=$(uuidgen)
    - echo $UUID
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION clean install -DskipTests
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION -pl dlic-security test
  artifacts:
    when: always
    reports:
      junit:
        - "*/target/surefire-reports/TEST-*.xml"
        - "*/target/failsafe-reports/TEST-*.xml"
    expire_in: 1 week
  cache:
    key: mavenrepo
    paths:
      - .m2/repository
    policy: pull
    
test_dlic_security_legacy:
  stage: test
  interruptible: true
  tags:
    - hetzner-gitLab-runner-1
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-UT.*/'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-TESTS.*/'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: '$CI_COMMIT_TAG =~ /^sg-flx-.*/'
      when: always
    - when: always
  script:
    - UUID=$(uuidgen)
    - echo $UUID
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION clean install -DskipTests
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION -pl dlic-security-legacy test
  artifacts:
    when: always
    reports:
      junit:
        - "*/target/surefire-reports/TEST-*.xml"
        - "*/target/failsafe-reports/TEST-*.xml"
    expire_in: 1 week
  cache:
    key: mavenrepo
    paths:
      - .m2/repository
    policy: pull    

test_dlic_dlsfls:
  stage: test
  interruptible: true
  tags:
    - hetzner-gitLab-runner-1
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-UT.*/'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-TESTS.*/'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: '$CI_COMMIT_TAG =~ /^sg-flx-.*/'
      when: always
    - when: always
  script:
    - UUID=$(uuidgen)
    - echo $UUID
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION clean install -DskipTests
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION -pl dlic-dlsfls test
  artifacts:
    when: always
    reports:
      junit:
        - "*/target/surefire-reports/TEST-*.xml"
        - "*/target/failsafe-reports/TEST-*.xml"
    expire_in: 1 week
  cache:
    key: mavenrepo
    paths:
      - .m2/repository
    policy: pull
    
test_dlic_dlsfls_legacy:
  stage: test
  interruptible: true
  tags:
    - hetzner-gitLab-runner-1
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-UT.*/'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-TESTS.*/'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: '$CI_COMMIT_TAG =~ /^sg-flx-.*/'
      when: always
    - when: always
  script:
    - UUID=$(uuidgen)
    - echo $UUID
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION clean install -DskipTests
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION -pl dlic-dlsfls-legacy test
  artifacts:
    when: always
    reports:
      junit:
        - "*/target/surefire-reports/TEST-*.xml"
        - "*/target/failsafe-reports/TEST-*.xml"
    expire_in: 1 week
  cache:
    key: mavenrepo
    paths:
      - .m2/repository
    policy: pull    

test_dlic_femt:
  stage: test
  interruptible: true
  tags:
    - hetzner-gitLab-runner-1
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-UT.*/'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-TESTS.*/'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: '$CI_COMMIT_TAG =~ /^sg-flx-.*/'
      when: always
    - when: always
  script:
    - UUID=$(uuidgen)
    - echo $UUID
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION clean install -DskipTests
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION -pl dlic-fe-multi-tenancy test
  artifacts:
    when: always
    reports:
      junit:
        - "*/target/surefire-reports/TEST-*.xml"
        - "*/target/failsafe-reports/TEST-*.xml"
    expire_in: 1 week
  cache:
    key: mavenrepo
    paths:
      - .m2/repository
    policy: pull

test_dlic_auditlog:
  stage: test
  interruptible: true
  tags:
    - hetzner-gitLab-runner-1
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-UT.*/'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-TESTS.*/'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: '$CI_COMMIT_TAG =~ /^sg-flx-.*/'
      when: always
    - when: always
  script:
    - UUID=$(uuidgen)
    - echo $UUID
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION clean install -DskipTests
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION -pl dlic-auditlog test
  artifacts:
    when: always
    reports:
      junit:
        - "*/target/surefire-reports/TEST-*.xml"
        - "*/target/failsafe-reports/TEST-*.xml"
    expire_in: 1 week
  cache:
    key: mavenrepo
    paths:
      - .m2/repository
    policy: pull

test_dlic_signals:
  stage: test
  interruptible: true
  tags:
    - hetzner-gitLab-runner-1
  rules:
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-UT.*/'
      when: never
    - if: '$CI_COMMIT_MESSAGE =~ /.*SKIP-TESTS.*/'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: always
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: '$CI_COMMIT_TAG =~ /^sg-flx-.*/'
      when: always
    - when: always
  script:
    - UUID=$(uuidgen)
    - echo $UUID
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION clean install -DskipTests
    - mvn $MAVEN_CLI_OPTS -Drevision=$UUID-SNAPSHOT -Delasticsearch.version=$ES_VERSION -pl dlic-signals test
  artifacts:
    when: always
    reports:
      junit:
        - "*/target/surefire-reports/TEST-*.xml"
        - "*/target/failsafe-reports/TEST-*.xml"
    expire_in: 1 week
  cache:
    key: mavenrepo
    paths:
      - .m2/repository
    policy: pull
