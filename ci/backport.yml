variables:
  # GITLAB_TOKEN: ${GITLAB_TOKEN}

backport_automation:
  image: floragunncom/python-toolbox:251218
  stage: post_merge
  rules:
    - if: >
        $CI_PIPELINE_SOURCE == "push" &&
        $CI_COMMIT_TITLE =~ /^Merge branch.*/
      # && $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "main" # Uncomment this if want backport only from main branch
      when: always
  before_script:
    - |
      if [ -z "${GITLAB_TOKEN}" ]; then
        echo "ERROR: GITLAB_TOKEN is not set!"
        exit 1
      fi
  script:
    - pip install -r ci/backport/requirements.txt
    - python ci/backport/backport.py 


